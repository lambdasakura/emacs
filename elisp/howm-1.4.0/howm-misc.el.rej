***************
*** 1,7 ****
  ;;; howm-misc.el --- Wiki-like note-taking tool
- ;;; Copyright (C) 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011
  ;;;   HIRAOKA Kazuyuki <khi@users.sourceforge.jp>
- ;;; $Id: howm-misc.el,v 1.92 2011-12-28 09:40:06 hira Exp $
  ;;;
  ;;; This program is free software; you can redistribute it and/or modify
  ;;; it under the terms of the GNU General Public License as published by
--- 1,7 ----
  ;;; howm-misc.el --- Wiki-like note-taking tool
+ ;;; Copyright (C) 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012
  ;;;   HIRAOKA Kazuyuki <khi@users.sourceforge.jp>
+ ;;; $Id: howm-misc.el,v 1.94 2012-02-18 12:03:31 hira Exp $
  ;;;
  ;;; This program is free software; you can redistribute it and/or modify
  ;;; it under the terms of the GNU General Public License as published by
***************
*** 140,145 ****
                  (set (make-local-variable symbol) value)))
              a))))
  
  ;; copied and modified from set-auto-mode in /usr/share/emacs/21.2/lisp/files.el
  ;; (I don't want to set the mode actually. Sigh...)
  (howm-dont-warn-free-variable auto-mode-interpreter-regexp)
--- 140,148 ----
                  (set (make-local-variable symbol) value)))
              a))))
  
+ (defmacro howm-if-unbound (var &rest alt-body)
+   `(if (boundp ',var) ,var ,@alt-body))
+ 
  ;; copied and modified from set-auto-mode in /usr/share/emacs/21.2/lisp/files.el
  ;; (I don't want to set the mode actually. Sigh...)
  (howm-dont-warn-free-variable auto-mode-interpreter-regexp)
***************
*** 170,178 ****
        (and enable-local-variables
             ;; Don't look for -*- if this file name matches any
             ;; of the regexps in inhibit-first-line-modes-regexps.
-            (let ((temp inhibit-first-line-modes-regexps)
                   (name (file-name-sans-versions (or file-name ""))))
-              (while (let ((sufs inhibit-first-line-modes-suffixes))
                        (while (and sufs (not (string-match (car sufs) name)))
                          (setq sufs (cdr sufs)))
                        sufs)
--- 173,183 ----
        (and enable-local-variables
             ;; Don't look for -*- if this file name matches any
             ;; of the regexps in inhibit-first-line-modes-regexps.
+            (let ((temp (howm-if-unbound inhibit-first-line-modes-regexps
+                                         inhibit-local-variables-regexps))
                   (name (file-name-sans-versions (or file-name ""))))
+              (while (let ((sufs (howm-if-unbound inhibit-first-line-modes-suffixes
+                                                  inhibit-local-variables-suffixes)))
                        (while (and sufs (not (string-match (car sufs) name)))
                          (setq sufs (cdr sufs)))
                        sufs)
